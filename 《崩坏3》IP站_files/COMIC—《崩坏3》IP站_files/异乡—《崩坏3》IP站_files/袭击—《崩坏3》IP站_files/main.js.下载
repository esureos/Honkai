/*! Copyright © 2011 - 2020 miHoYo. All Rights Reserved */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.miHoYoAnalysis=t():e.miHoYoAnalysis=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(1),r=(o=a)&&o.__esModule?o:{default:o};var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app_id="",this.game_uid=null,this.game_region=null,this.needUid=!1,this.hasUpdateUid=!1,this.pvParams={eventCategory:"page",eventAction:"view"},this.pagename=void 0,this.pageurl=void 0,this.pageExtrainfo=void 0,this.userExtrainfo=void 0,this.eventExtrainfo=void 0,this.apis={production:"https://log-upload.mihoyo.com/h5/upload",sea:"https://log-upload-os.mihoyo.com/h5/upload",test:"https://devlog-upload.mihoyo.com/h5/upload"},this.eventList=[],this.environment=this.getEnv()}return i(e,[{key:"getEnv",value:function(){var e=window.location.host;return e.indexOf("webstatic.mihoyo.com")>-1?"production":e.indexOf("webstatic-sea.mihoyo.com")>-1?"sea":"production"}},{key:"getParamByName",value:function(e){var t=e.replace(/[\[\]]/g,"\\$&"),n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),o=window.location.search,i=n.exec(o);if(i)return i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):""}},{key:"getAccountid",value:function(){return r.default.get("account_id")||r.default.get("ltuid")}},{key:"isHash",value:function(){return window.location.href.indexOf("#/")>-1}},{key:"getPageInfo",value:function(){var e=this.isHash()?window.location.hash.replace("#",""):window.location.pathname;return{app_id:this.app_id,page_url:this.pageurl||e,page_name:this.pagename||e,utm_source:this.getParamByName("utm_source"),utm_medium:this.getParamByName("utm_medium"),utm_campaign:this.getParamByName("utm_campaign"),extra_info:this.pageExtrainfo}}},{key:"getUserInfo",value:function(){return{auth_key:this.getParamByName("authkey"),authkey_ver:this.getParamByName("authkey_ver"),game_biz:this.getParamByName("game_biz"),account_id:this.getAccountid(),game_uid:this.game_uid,game_region:this.game_region,extra_info:this.userExtrainfo}}},{key:"getEventInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.eventCategory,n=e.eventAction,o=e.eventLabel,i=e.eventValue,a={eventCategory:t,eventAction:n,eventLabel:o,eventValue:i,timestamp:(new Date).getTime(),extra_info:this.eventExtrainfo};return a}},{key:"getAllParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={page_info:this.getPageInfo(),user_info:this.getUserInfo(),event_info:this.getEventInfo(e)};return t}},{key:"trackEvent",value:function(e,t,n,o){try{var i={eventCategory:e,eventAction:t,eventLabel:n,eventValue:o},a=this.getAllParams(i);this.post(a)}catch(e){console.log(e)}}},{key:"trackPageview",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t=e.path,n=e.name;t&&(this.pageurl=t),n&&(this.pagename=n);var o=this.getAllParams(this.pvParams);this.post(o)}catch(e){console.log(e)}}},{key:"updateUid",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.hasUpdateUid=!0;var n=t.uid,o=t.region;this.game_uid=n,this.game_region=o,this.eventList.forEach((function(t,n){n>10||setTimeout((function(){try{t.user_info.game_uid=e.game_uid,t.user_info.game_region=e.game_region,e.post(t)}catch(e){console.error(e)}}),200*n)})),this.eventList=[]}},{key:"post",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t=this.apis[this.environment];if(!t)return;var n=new XMLHttpRequest;n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(e))}catch(e){console.error(e)}}}],[{key:"install",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new this,o=t.appId,i=t.router,a=t.needUid,r=t.env,u=t.debug,s=void 0!==u&&u,c=t.pageExtrainfo,f=t.userExtrainfo,l=t.eventExtrainfo;o?(r&&n.apis[r]&&(n.environment=r),s&&(n.environment="test"),e.prototype.$mia=n,n.app_id=o,n.needUid=a||!1,n.pageExtrainfo=c,n.userExtrainfo=f,n.eventExtrainfo=l,i?i.afterEach((function(e){var t=e||{},o=(t.meta||{}).miaPagename;n.pageurl=t.path,n.pagename=o||t.name||t.path,n.trackPageview()})):console.error("请传入vue router实例对象")):console.error("请传入appId")}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new this,n=e.appId,o=e.needUid,i=e.env,a=e.debug,r=void 0!==a&&a,u=e.pagename,s=e.pageExtrainfo,c=e.userExtrainfo,f=e.eventExtrainfo,l=e.autoTrackPageview,p=void 0===l||l;if(!n)throw console.error("请传入appId"),new Error("请传入appId");return i&&t.apis[i]&&(t.environment=i),r&&(t.environment="test"),t.app_id=n,t.needUid=o||!1,t.pagename=u,t.pageExtrainfo=s,t.userExtrainfo=c,t.eventExtrainfo=f,p&&t.trackPageview(),t}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},i=decodeURIComponent,a=encodeURIComponent;function r(e){return"string"==typeof e}function u(e){return r(e)&&""!==e}function s(e){if(!u(e))throw new TypeError("Cookie name must be a non-empty string")}function c(e){return e}o.get=function(e,t){s(e),t="function"==typeof t?{converter:t}:t||{};var n=function(e,t){var n={};if(r(e)&&e.length>0)for(var o,a,u,s=t?i:c,f=e.split(/\s/g),l=0,p=f.length;l<p;l++){if((u=f[l].match(/([^=]+)=/i))instanceof Array)try{o=i(u[1]),a=s(f[l].substring(u[1].length+1))}catch(e){console.log(e)}else o=i(f[l]),a="";o&&(n[o]=(a||"").replace(";",""))}return n}(document.cookie,!t.raw);return(t.converter||c)(n[e])},o.set=function(e,t,n){s(e);var o=(n=n||{}).expires,i=n.domain,r=n.path;n.raw||(t=a(String(t)));var c=e+"="+t,f=o;return"number"==typeof f&&(f=new Date).setDate(f.getDate()+o),f instanceof Date&&(c+=" expires="+f.toUTCString()),u(i)&&(c+=" domain="+i),u(r)&&(c+=" path="+r),n.secure&&(c+=" secure"),document.cookie=c,c},o.remove=function(e,t){return(t=t||{}).expires=new Date(0),this.set(e,"",t)},t.default=o}]).default}));